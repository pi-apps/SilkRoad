<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>SilkRoad</title>
    <meta name="description" content="SilkRoad" />
        
    <meta property="og:url" content="/"/>
    <meta property="og:type" content="website"/>
    <meta property="og:title" content="SilkRoad"/>
    <meta property="og:description" content="SilkRoad"/>
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <!-- ios support -->
    <meta name="apple-mobile-web-app-status-bar" content="#db4938" />
    <meta name="theme-color" content="#db4938" />

    <meta name="application-name" content="SilkRoad Example">
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
        <script src="assets/js/html5shiv-pre3.6.js"></script>
    <![endif]-->

    <meta property="og:image" content="logo.png" />
    <link href="logo.png" rel="shortcut icon" />

    <script type="text/javascript" src="jquery-3.5.1.min.js"></script>
    <!--<script src="https://downloads.minepi.com/sdk/v1/dev.js"></script>-->
    <!--<script src="https://downloads.minepi.com/sdk/v1/prod.js"></script>-->
    <script src="https://sdk.minepi.com/pi-sdk.js"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/all.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>
</head>
<body>
    <div class="container form-group" style="text-align:center">

        <style>
                .goog-te-banner-frame.skiptranslate {
                    display: none !important;
                }
                .skiptranslate > iframe {
                    display: none !important;
                }
                
                body {
                    top: 0px !important; 
                }

                .goog-te-menu-frame {
                    max-width:100% !important; 
                }
                .goog-te-menu2 { 
                    max-width: 100% !important;
                    overflow-x: scroll !important;
                    box-sizing:border-box !important; 
                    height:auto !important; 
                }
                
                #goog-gt-tt, #goog-gt-, .goog-te-balloon-frame{display: none !important;} 
                .goog-text-highlight { background: none !important; box-shadow: none !important;}
                
                .goog-logo-link{display: none !important;}
                .goog-te-gadget{height: 28px !important;  overflow: hidden;}
            </style>
            
            <script type="text/javascript">
                function googleTranslateElementInit() {
                      var lang_google='en';
                      
                      new google.translate.TranslateElement({pageLanguage: lang_google,
                                                            autoDisplay: true,
                                                            layout: google.translate.TranslateElement.InlineLayout.VERTICAL}, 
                                                            'google_translate_element');
                     
                        //const el = document.querySelector('#goog-gt-');
                        //const el2 = document.querySelector('.skiptranslate');
                        const el3 = document.querySelector('circle');
                        //const el4 = document.querySelector('.goog-te-gadget');
                        const observer = new window.IntersectionObserver(([entry]) => {
                            /*for(var i = 0; i &lt; document.getElementsByClassName("skiptranslate").length; i++)
                            {
                                for(var j = 0; j &lt; document.getElementsByClassName("skiptranslate")[i].childNodes.length; j++)
                                {
                                    if(document.getElementsByClassName("skiptranslate")[i].childNodes[j].tagName == "IFRAME")
                                        document.getElementsByClassName("skiptranslate")[i].style.display = "none";
                                }
                            }
                            document.getElementById("goog-gt-").style.display = "none";*/
                            document.getElementsByTagName("circle")[0].parentNode.parentNode.style.display = "none";
                        }, {
                            root: null,
                            threshold: 0.1, // set offset 0.1 means trigger if atleast 10% of element in viewport
                        });

                        //observer.observe(el);
                        //observer.observe(el2);
                        observer.observe(el3);
                        //observer.observe(el4);
                  
                }
            </script>

            <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
            <strong>Translate</strong>
            <div id="google_translate_element"></div>
            <br/>
            <img src="logo.png" alt="LatinChain" class="img-fluid" style="width: 200px; height: 100px;" />
        <br/>
        <br/>
        <h1>Pi cryptocurrency donation on SilkRoad</h1>
        <br/>
        <br/>
        <div id="username">Hello</div>
        <br/>
        <div>Remember access through Pi Browser</div>
        <br/>
        <br/>
        <button id="clear_cache" class="btn btn-info font-weight-bold text-black" style="border: 2px solid;"><div style=""><i class="fa fa-refresh"></i></div><div style="font-size:100%;">Clear Cache</div></button>
        <br/>
        <br/>
        <input id="pi_donate" name="pi_donate" class="form-text" type="number" min="0" step="0.01" lang="en-US" placeholder="Amount in Pi" />
        <input id="button_click" name="button_click" value="Donate Pi" type="button" class="btn btn-primary" />

        <br /><br />
        <div>Share in Social Networks:</div>
        <br />
        <button id="social_share" class="btn btn-outline-primary" style="border-radius: 50%; border: 2px solid;"><i class="fa fa-share-alt"></i></button>
        <br /><br />
        <a href="marketing.html">About us</a>
        <br /><br />
        <h3>
            The Silk Road for Pi of PI-CLOVER JSC is a series of modern trade networks connecting all parts of the World. The route consists of a set of trading points and markets used to help store, exchange and exchange goods, it is an E-Commerce Site. It is also known as Silk Road for Pi.
        </h3>
        <br /><br />

        <div id="share_message" style="display:none;">Hi. Check it out this Pi App: SilkRoad for Pi. Try it in Pi Browser. #PiNetwork #PiApps</div>
        <div id="pi_username_message" style="display:none;">Pi username: <span translate="no" class="referrer_username"></span></div>
    </div>
    <script type="text/javascript">
        $(document).ready(function () {
            const btn = document.querySelector('#social_share');
            //const resultPara = document.querySelector('.result');
                           
            // Must be triggered some kind of "user activation"
            btn.addEventListener('click', async () => {
                const shareData = {
                   title: 'LatinChain Platform',
                   text: $("#share_message").text() + "\n\nWebpage:\nhttps://pisilkroad.com/\n\n" + $("#pi_username_message").text(),
                   //url: 'https://latin-chain.com/',
                }
                                
                if (!navigator.share) {
                 Pi.openShareDialog(shareData.title, shareData.text);
                }else
                {
                  try {
                      await navigator.share(shareData);
                      //resultPara.textContent = 'MDN shared successfully'
                  } catch(err) {
                       //alert('Error: ' + err);
                  }
                }
            });

            $( "#clear_cache" ).click(function() {
                                    try {
                                        Cache.delete();
                                    } catch (err) {
                                        console.error(err);
                                    }
                                    try {
                                        window.location.reload(true);
                                    } catch (err) {
                                        console.error(err);
                                    }
            });

            const Pi = window.Pi;
            Pi.init({ version: "2.0" });

            //alert(PiNetworkClient);

            async function auth() {
                try {
                    // Identify the user with their username / unique network-wide ID, and get permission to request payments from them.
                    const scopes = ['username', 'payments', 'wallet_address'];
                    function onIncompletePaymentFound(payment) {
                        var data = {
                            'action': 'complete',
                            'paymentId': payment.identifier,
                            'txid': payment.transaction.txid,
                            'app_client': 'silkroad'
                        };
                        return $.post("https://pisilkroad.com/server1.php", data).done(function (data) {
                            $("#button_click").prop("disabled", false);
                        }).fail(function () {
                            $("#button_click").prop("disabled", false);
                        });
                    }; // Read more about this in the SDK reference

                    Pi.authenticate(scopes, onIncompletePaymentFound).then(function (auth) {
                        $("#button_click").click(function () {
                            if (parseFloat($("#pi_donate").val()) > 0) {
                                $("#button_click").prop("disabled", true);
                                /*setTimeout(function ()
                                {
                                    $("#button_click").prop( "disabled", false );
                                }, 10000);*/
                                transfer();
                            }
                            //alert("Click");
                        });
                        $("#username").html( "Hello, <strong>" + auth.user.username + "</strong>");
                        $("#referrer_username").html( "<strong>" + auth.user.username + "</strong>");
                        //alert('Hello ' + auth.user.username);
                    }).catch(function (error) {
                        console.error(error);
                    });
                } catch (err) {
                    alert(err);
                    // Not able to fetch the user
                }
            }

            async function transfer() {
                try {
                    const payment = Pi.createPayment({
                        // Amount of π to be paid:
                        amount: parseFloat($("#pi_donate").val()),
                        // An explanation of the payment - will be shown to the user:
                        memo: "Donation to SilkRoad for Pi", // e.g: "Digital kitten #1234",
                        // An arbitrary developer-provided metadata object - for your own usage:
                        metadata: { paymentType: "donation" /* ... */ }, // e.g: { kittenId: 1234 }
                    }, {
                            // Callbacks you need to implement - read more about those in the detailed docs linked below:
                            onReadyForServerApproval: function (paymentId) {
                                var data = {
                                    'action': 'approve',
                                    'paymentId': paymentId,
                                    'txid': '',
                                    'app_client': 'silkroad'
                                };
                                return $.post("https://pisilkroad.com/server1.php", data).done(function (data) {
                                    $("#button_click").prop("disabled", false);
                                }).fail(function () {
                                    $("#button_click").prop("disabled", false);
                                });
                            },
                            onReadyForServerCompletion: function (paymentId, txid) {
                                var data = {
                                    'action': 'complete',
                                    'paymentId': paymentId,
                                    "txid": txid,
                                    'app_client': 'silkroad'
                                };
                                return $.post("https://pisilkroad.com/server1.php", data).done(function (data) {
                                    $("#button_click").prop("disabled", false);
                                }).fail(function () {
                                    $("#button_click").prop("disabled", false);
                                });
                            },
                            onCancel: function (paymentId) { $("#button_click").prop("disabled", false); /* ... */ },
                            onError: function (error, payment) { $("#button_click").prop("disabled", false); /* ... */ },
                        });
                } catch (err) {
                    $("#button_click").prop("disabled", false);
                    alert(err);
                    // Technical problem (eg network failure). Please try again
                }
            }

            auth();

        });
    </script>
</body>
</html>
